# Journal App Plan

## Overview

PWA journal app with one screen per day, swipe navigation, Claude AI responses, and auto-save using Automerge for local-first persistence.

## Tech Stack

- React 19 + TypeScript + Vite + Tailwind v4 (existing)
- Automerge + automerge-repo + IndexedDB for local-first storage
- `@anthropic-ai/sdk` with `dangerouslyAllowBrowser: true`
- Google Calendar API for day's events
- Browser Geolocation API for location capture

## Data Model (Automerge)

```typescript
interface JournalDoc {
  entries: Record<string, JournalEntry> // key: "2024-01-15"
  settings: Settings
}

interface JournalEntry {
  date: string
  content: string // auto-saved draft
  messages: Message[] // conversation with Claude
  location: { lat: number; lng: number } | null
  calendarEvents: CalendarEvent[]
}

interface Message {
  role: "user" | "assistant"
  content: string
  timestamp: number
}

interface Settings {
  claudeApiKey: string | null
  googleAccessToken: string | null
}
```

## File Structure

```
src/
├── types/journal.ts           # TypeScript interfaces
├── lib/
│   ├── repo.ts                # Automerge repo + IndexedDB
│   ├── dates.ts               # Date formatting
│   ├── claude.ts              # Anthropic SDK wrapper
│   └── google-calendar.ts     # OAuth + API
├── context/JournalContext.tsx # App state + Automerge
├── hooks/
│   ├── useJournal.ts
│   ├── useSwipeNavigation.ts
│   ├── useGeolocation.ts
│   └── useGoogleCalendar.ts
├── components/
│   ├── DayView.tsx            # Main screen
│   ├── Header.tsx             # Date display + picker trigger
│   ├── DatePicker.tsx         # Calendar with content dots
│   ├── EntryEditor.tsx        # Textarea with auto-save
│   ├── ClaudeSection.tsx      # Submit + response
│   ├── LocationBadge.tsx
│   ├── CalendarEvents.tsx
│   ├── SettingsView.tsx
│   └── SwipeContainer.tsx
```

## Implementation Phases

### Phase 1: Data Layer

1. `pnpm add @automerge/automerge @automerge/automerge-repo @automerge/automerge-repo-storage-indexeddb @automerge/automerge-repo-react-hooks`
2. Create `src/types/journal.ts`
3. Create `src/lib/repo.ts` - initialize repo with IndexedDB
4. Create `src/context/JournalContext.tsx` - wrap app, provide document access

### Phase 2: Core UI

1. Create `src/lib/dates.ts` - formatDate, parseDate, getToday, addDays
2. Create `src/components/EntryEditor.tsx` - textarea with debounced auto-save
3. Create `src/components/DayView.tsx` - show entry for current date
4. Create `src/components/Header.tsx` - date display, settings link
5. Update `src/App.tsx` - hash routing between dates

### Phase 3: Navigation

1. `pnpm add @tabler/icons-react` (already installed)
2. Create `src/hooks/useSwipeNavigation.ts` - touch gestures
3. Create `src/components/SwipeContainer.tsx` - wrap DayView
4. Create `src/components/DatePicker.tsx` - shadcn Calendar with dots for days with content
5. Add keyboard navigation (← →)

### Phase 4: Claude Integration

1. `pnpm add @anthropic-ai/sdk`
2. Create `src/lib/claude.ts` - sendMessage function
3. Create `src/hooks/useClaude.ts` - manage conversation state
4. Create `src/components/ClaudeSection.tsx` - submit button + response
5. Create `src/components/SettingsView.tsx` - API key input

### Phase 5: Integrations

1. Create `src/hooks/useGeolocation.ts` - capture on entry creation
2. Create `src/components/LocationBadge.tsx` - display location
3. Set up Google Cloud project (see below)
4. Create `src/lib/google-calendar.ts` - OAuth + fetch events
5. Create `src/hooks/useGoogleCalendar.ts`
6. Create `src/components/CalendarEvents.tsx`

## Google Cloud Setup Instructions

1. Go to https://console.cloud.google.com/
2. Create new project "Journal App"
3. Enable Google Calendar API
4. Configure OAuth consent screen (External, test mode)
5. Create OAuth 2.0 Client ID (Web application)
   - Add authorized JavaScript origins: `http://localhost:5173`
   - Add authorized redirect URIs: `http://localhost:5173`
6. Copy Client ID to environment variable `VITE_GOOGLE_CLIENT_ID`

## Routing

Hash-based routing (no server config needed):

- `/#/` → redirect to `/#/day/today`
- `/#/day/2024-01-15` → DayView for that date
- `/#/settings` → SettingsView

## Verification

1. **Auto-save**: Type in entry, refresh page, content persists
2. **Navigation**: Swipe left/right changes date, URL updates
3. **Date picker**: Shows dots on days with content, selecting navigates
4. **Claude**: Enter API key, submit entry, get response
5. **Location**: Permission prompt, badge shows coordinates
6. **Calendar**: OAuth flow, events appear for day
7. **PWA**: Install prompt works, offline access works
8. **Tests**: `pnpm test` and `pnpm test:pw` pass
